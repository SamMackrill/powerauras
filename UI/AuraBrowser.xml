<Ui xmlns="http://www.blizzard.com/wow/ui/"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.blizzard.com/wow/ui/
    ..\..\FrameXML\UI.xsd">
	<Script file="AuraBrowser.lua" />
	<!-- Todo: Put this in another file? Doubt it. -->
	<Button name="PowaAuraButtonTemplate" virtual="true">
		<!-- Yes, I really am using totem bar textures here. I haven't gone insane yet. -->
		<NormalTexture file="Interface\Buttons\UI-TotemBar" setAllPoints="true">
			<!-- Linked texture: -->
			<!-- <TexCoords left="0.0078125" right="0.2734375" top="0.671875" bottom="0.8046875" /> -->
			<TexCoords left="0.0078125" right="0.2734375" top="0.80859375" bottom="0.94140625" />
			<Color r="0.75" g="0.325" b="0.325" />
		</NormalTexture>
		<HighlightTexture file="Interface\Buttons\UI-TotemBar" alphaMode="ADD" setAllPoints="true">
			<TexCoords left="0.0078125" right="0.2734375" top="0.80859375" bottom="0.94140625" />
		</HighlightTexture>
		<Layers>
			<Layer level="BACKGROUND">
				<Texture parentKey="Icon">
					<Anchors>
						<Anchor point="TOPLEFT" x="5" y="-5" />
						<Anchor point="BOTTOMRIGHT" x="-5" y="5" />
					</Anchors>
					<!-- Cuts the border out of icons. -->
					<TexCoords left="0.07" right="0.93" top="0.07" bottom="0.93" />
				</Texture>
			</Layer>
		</Layers>
	</Button>
	
	<CheckButton name="PowaCreateAuraRadioButtonTemplate" virtual="true">
		<Size x="400" y="58" />
		<Backdrop bgFile="Interface\ChatFrame\ChatFrameBackground" edgeFile="Interface\ChatFrame\ChatFrameBackground" tile="true">
			<EdgeSize>
				<AbsValue val="1" />
			</EdgeSize>
			<TileSize>
				<AbsValue val="5" />
			</TileSize>
			<Color r="0.0" g="0.0" b="0.0" a="1" />
			<BorderColor r="0.3" g="0.3" b="0.3" a="1" />
		</Backdrop>
		<Layers>
			<Layer level="OVERLAY">
				<Texture parentKey="Icon" file="Interface\PaperDollInfoFrame\Character-Plus" desaturated="true">
					<Size x="32" y="32" />
					<Anchors>
						<Anchor point="LEFT" x="10" y="0" />
					</Anchors>
				</Texture>
				<FontString name="$parentTitle" parentKey="Title" font="PowaFontNormal" text="Create Blank Aura" justifyH="LEFT" justifyV="TOP">
					<Size x="1" y="20" />
					<Anchors>
						<Anchor point="TOPLEFT" x="56" y="-4" />
						<Anchor point="TOPRIGHT" x="-4" y="-4" />
					</Anchors>
				</FontString>
				<FontString parentKey="Desc" font="PowaFontHighlight" text="Create Blank Aura" justifyH="LEFT" justifyV="TOP">
					<Anchors>
						<Anchor point="TOPLEFT" x="56" y="-20" />
						<Anchor point="BOTTOMRIGHT" x="-8" y="4" />
					</Anchors>
				</FontString>
			</Layer>
		</Layers>
	</CheckButton>
	
	<Frame name="PowaBrowser" toplevel="true" movable="true" parent="UIParent" hidden="false" frameStrata="MEDIUM" enableMouse="true" enableKeyboard="true">
		<Size>
          <AbsDimension x="550" y="450" />
        </Size>
        <Anchors>
			<Anchor point="CENTER" relativeTo="UIParent" x="0" y="50" />
        </Anchors>
		<Backdrop bgFile="Interface\DialogFrame\UI-DialogBox-Background" edgeFile="Interface\DialogFrame\UI-DialogBox-Border" tile="true">
			<BackgroundInsets>
				<AbsInset left="11" right="12" top="12" bottom="11" />
			</BackgroundInsets>
			<TileSize>
				<AbsValue val="32" />
			</TileSize>
			<EdgeSize>
				<AbsValue val="32" />
			</EdgeSize>
		</Backdrop>	
		<Scripts>
			<OnMouseDown>
				if(button == "LeftButton" and not self.isMoving) then
					self:StartMoving();
					self.isMoving = true;
				end
			</OnMouseDown>
			<OnMouseUp>
				if(button == "LeftButton" and self.isMoving) then
					self:StopMovingOrSizing();
					self.isMoving = false;
				end
			</OnMouseUp>
			<OnHide>
				if(self.isMoving) then
					self:StopMovingOrSizing();
					self.isMoving = false;
				end
			</OnHide>
			<OnLoad>
				self.Title:SetText(format("Power Auras %s", PowaAuras.Version));
				PowaAuras.UI:AuraBrowser(self);
			</OnLoad>
		</Scripts>
		<Layers>
			<Layer level="ARTWORK">
				<Texture file="Interface\DialogFrame\UI-DialogBox-Header">
					<Size>
						<AbsDimension x="300" y="68" />
					</Size>
					<Anchors>
						<Anchor point="TOP" relativePoint="TOP" x="0" y="13"/>
					</Anchors>					
				</Texture>
				<FontString parentKey="Title" inherits="PowaFontNormal" text="Power Auras %s" justifyH="CENTER" justifyV="TOP">
					<Size>
						<AbsDimension x="300" y="68" />
					</Size>
					<Anchors>
						<Anchor point="TOP" relativePoint="TOP" x="0" y="-2"/>
					</Anchors>
				</FontString>
				<Texture file="Interface\DialogFrame\UI-DialogBox-Corner">
					<Size x="32" y="32" />	
					<Anchors>
						<Anchor point="TOPRIGHT" x="-4" y="-4" />	
					</Anchors>
				</Texture>
			</Layer>
		</Layers>
		<Frames>
			<Button name="$parentCloseButton" inherits="UIPanelCloseButton">
				<Anchors>
					<Anchor point="TOPRIGHT" x="0" y="0" />
				</Anchors>
			</Button>
			<Frame name="$parentTabs" parentKey="Tabs" inherits="PowaBorderedFrameTemplate">
				<Size>
				  <AbsDimension y="260" />
				</Size>
				<Anchors>
					<Anchor point="TOP" x="0" y="-65" />
					<Anchor point="LEFT" x="15" y="0" />
					<Anchor point="RIGHT" x="-15" y="0" />
					<Anchor point="BOTTOM" x="0" y="15" />
				</Anchors>
				<Frames>
					<Frame parentKey="Auras" hidden="true">
						<Anchors>
							<Anchor point="TOPLEFT" x="4" y="-4" />
							<Anchor point="BOTTOMRIGHT" x="-4" y="5" />
						</Anchors>
						<Frames>
							<Frame name="$parentAurasTree" parentKey="Tree" inherits="PowaTreeViewTemplate">
								<Anchors>
									<Anchor point="TOPLEFT" x="2" y="-2" />
									<Anchor point="BOTTOMLEFT" x="2" y="2" />
								</Anchors>
								<Scripts>
									<OnLoad>
										PowaAuras.UI:TreeView(self);
									</OnLoad>
								</Scripts>
							</Frame>
							<Frame parentKey="Page" inherits="PowaBorderedFrameTemplate">
								<Anchors>
									<Anchor point="TOPLEFT" x="177" y="-2" />
									<Anchor point="BOTTOMRIGHT" x="-2" y="2" />
								</Anchors>
								<Layers>
									<Layer level="ARTWORK">
										<Texture file="Interface\LevelUp\LevelUpTex">
											<Size x="419" y="2" />
											<Anchors>
												<Anchor point="TOPLEFT" x="0" y="-45" />
												<Anchor point="TOPRIGHT" x="0" y="-45" />
											</Anchors>
											<TexCoords left="0" right="0.818359375" top="0.013671875" bottom="0.017578125" />
											<Color r="0.3" g="0.3" b="0.3" a="1.0" />
										</Texture>
										<Texture file="Interface\LevelUp\LevelUpTex">
											<Size x="419" y="2" />
											<Anchors>
												<Anchor point="TOPLEFT" x="0" y="-242" />
												<Anchor point="TOPRIGHT" x="0" y="-242" />
											</Anchors>
											<TexCoords left="0" right="0.818359375" top="0.013671875" bottom="0.017578125" />
											<Color r="0.3" g="0.3" b="0.3" a="1.0" />
										</Texture>
										<FontString parentKey="SelectedTitle" justifyH="LEFT" justifyV="TOP" font="PowaFontNormalLarge">
											<Size x="225" y="24" />
											<Anchors>
												<Anchor point="TOPLEFT" x="15" y="-250" />
												<Anchor point="TOPRIGHT" x="-15" y="-250" />
											</Anchors>
										</FontString>
									</Layer>
								</Layers>
								<Frames>
									<EditBox parentKey="Title" justifyH="LEFT" justifyV="MIDDLE" font="PowaFontNormalLarge" letters="15" autoFocus="false">
										<Size x="225" y="40" />
										<Anchors>
											<Anchor point="TOPLEFT" x="15" y="-4" />
											<Anchor point="TOPRIGHT" x="-15" y="-4" />
										</Anchors>	
										<Scripts>
											<OnEscapePressed>
												self:SetText(PowaBrowser:GetPageName());
												self:ClearFocus();
											</OnEscapePressed>
											<OnEditFocusGained>
												self:HighlightText();
											</OnEditFocusGained>
											<OnEditFocusLost>
												self:HighlightText(0,0);
											</OnEditFocusLost>
											<OnEnterPressed>
												PowaBrowser:SavePageName(self:GetText());
												self:SetText(PowaBrowser:GetPageName());
												self:ClearFocus();
											</OnEnterPressed>
										</Scripts>
									</EditBox>
								</Frames>
								<Scripts>
									<OnLoad>
										-- Init layout frame, lock layout to speed up load.
										PowaAuras.UI:LayoutFrame(self, 0, 49, 2, true);
										-- Add columns.
										self:AddColumn(48, 48);
										self:AddColumn(48, 48);
										self:AddColumn(48, 48);
										self:AddColumn(48, 48);
										self:AddColumn(48, 48);
										self:AddColumn(48, 48);
										-- Unlock layout. This will trigger 1 update, as opposed to about 8 updates while initializing.
										self:SetLocked(false);
									</OnLoad>
								</Scripts>
							</Frame>
							<Frame parentKey="Create" inherits="PowaBorderedTabDialogTemplate">
								<Anchors>
									<Anchor point="TOPLEFT" x="177" y="-2" />
									<Anchor point="BOTTOMRIGHT" x="-2" y="2" />
								</Anchors>
								<Layers>
									<Layer level="ARTWORK">
										<FontString parentKey="Title" justifyH="LEFT" justifyV="MIDDLE" font="PowaFontNormalLarge">
											<Size x="225" y="40" />
											<Anchors>
												<Anchor point="TOPLEFT" x="15" y="-4" />
												<Anchor point="TOPRIGHT" x="-15" y="-4" />
											</Anchors>
										</FontString>
									</Layer>
								</Layers>
								<Scripts>
									<OnLoad>
										-- I'm a dialog. Hi.
										PowaAuras.UI:TabDialog(self);
										self.OnAccept = function()
											if(self.SelectedKey == 1) then
												-- Create aura.
												print("|cFF527FCCDEBUG (AuraBrowser): |rCreating Blank Aura");
												PowaAuras.Helpers:CreateAura();
												-- Done.
												PowaBrowser:SetSelectedAura(PowaBrowser:GetSelectedAura(), false);
											elseif(self.SelectedKey == 2) then
												-- Import preset.
												print("|cFF527FCCDEBUG (AuraBrowser): |rPreset Import Dialog NYI");
											elseif(self.SelectedKey == 3) then
												-- Import from code.
												print("|cFF527FCCDEBUG (AuraBrowser): |rPreset Import Code NYI");
											end
										end
										self.OnCancel = function()
											PowaBrowser:SetSelectedAura(nil, false);
											self:GetParent():SelectTab(1);
										end
										-- I'm also a radio button host.
										PowaAuras.UI:RadioGroup(self, "CreateAuraRadioButton", true);
										for i=1,3 do
											local item = self:AddItem(i);
											item:SetPoint("TOPLEFT", 15, -50-((i-1)*63));
											item:SetPoint("TOPRIGHT", -15, -50-((i-1)*63));
											if(i == 1) then
												item.Title:SetText(PowaAuras.Text["UI_CreateNew"]);
												item.Desc:SetText(PowaAuras.Text["UI_CreateNewDesc"]);
												SetDesaturation(item.Icon, false);
											elseif(i == 2) then
												item.Icon:SetTexture("Interface\\Glues\\CharacterCreate\\UI-CHARACTERCREATE-CLASSES");
												item.Icon:SetTexCoord(unpack(CLASS_ICON_TCOORDS[select(2, UnitClass("player"))]));
												item.Title:SetText(PowaAuras.Text["UI_CreatePreset"]);
												item.Desc:SetText(PowaAuras.Text["UI_CreatePresetDesc"]);
												SetDesaturation(item.Icon, true);
											elseif(i == 3) then
												item.Icon:SetTexture("Interface\\Buttons\\UI-MicroStream-Green");
												item.Icon:SetTexCoord(0.15, 0.85, 0.15, 0.85);
												item.Title:SetText(PowaAuras.Text["UI_CreateImport"]);
												item.Desc:SetText(PowaAuras.Text["UI_CreateImportDesc"]);
												SetDesaturation(item.Icon, true);
											end
										end
										-- Update on selection changed.
										self.OnSelectionChanged = function(self, key)
											if(key == 2) then
												self.AcceptButton:SetText(PowaAuras.Text["UI_Next"]);
											else
												self.AcceptButton:SetText(PowaAuras.Text["UI_Save"]);
											end
										end
									</OnLoad>
								</Scripts>
							</Frame>
						</Frames>
						<Scripts>
							<OnLoad>
								-- I'm also a tab frame. Hi.
								PowaAuras.UI:TabFrame(self, 3);
								self:RegisterTab(self.Page, "");
								self:RegisterTab(self.Create, "");
								self.Create.Title:SetText(PowaAuras.Text["UI_CreateAura"]);
							</OnLoad>
						</Scripts>
					</Frame>
					<Frame parentKey="Config" hidden="true">
						<Anchors>
							<Anchor point="TOPLEFT" x="4" y="-4" />
							<Anchor point="BOTTOMRIGHT" x="-4" y="5" />
						</Anchors>
						<Layers>
							<Layer level="ARTWORK">
								<FontString parentKey="TitleConfig" justifyH="LEFT" justifyV="MIDDLE" font="PowaFontNormalLarge">
									<Size x="225" y="40" />
									<Anchors>
										<Anchor point="TOPLEFT" x="11" y="0" />
										<Anchor point="TOPRIGHT" x="-11" y="0" />
									</Anchors>
								</FontString>
								<FontString parentKey="TitlePerformance" justifyH="LEFT" justifyV="MIDDLE" font="PowaFontNormalLarge">
									<Size x="225" y="40" />
									<Anchors>
										<Anchor point="TOPLEFT" x="11" y="-135" />
										<Anchor point="TOPRIGHT" x="-11" y="-135" />
									</Anchors>
								</FontString>
								<FontString parentKey="TitleCustom" justifyH="LEFT" justifyV="MIDDLE" font="PowaFontNormalLarge">
									<Size x="225" y="40" />
									<Anchors>
										<Anchor point="TOPLEFT" x="11" y="-225" />
										<Anchor point="TOPRIGHT" x="-11" y="225" />
									</Anchors>
								</FontString>
							</Layer>
						</Layers>
						<Frames>
							<CheckButton parentKey="Enable" text="UI_Config_Enable" inherits="PowaNormalCheckboxTemplate">
								<Size x="150" y="28" />
								<Anchors>
									<Anchor point="TOPLEFT" x="16" y="-40" />
								</Anchors>
								<Scripts>
									<OnLoad>
										self:SetChecked(PowaAuras.Helpers:GetSetting("Disabled"));
										PowaAuras.UI:Checkbox(self, "Disabled", true);
									</OnLoad>
								</Scripts>
							</CheckButton>
							<CheckButton parentKey="Inspect" text="UI_Config_Inspect" inherits="PowaNormalCheckboxTemplate">
								<Size x="150" y="28" />
								<Anchors>
									<Anchor point="TOPLEFT" relativePoint="TOP" x="16" y="-40" />
								</Anchors>
								<Scripts>
									<OnLoad>
										self:SetChecked(PowaAuras.Helpers:GetSetting("AllowInspections"));
										PowaAuras.UI:Checkbox(self, "AllowInspections");
									</OnLoad>
								</Scripts>
							</CheckButton>
							<CheckButton parentKey="RoundTimer" text="UI_Config_RoundTimer" inherits="PowaNormalCheckboxTemplate">
								<Size x="150" y="28" />
								<Anchors>
									<Anchor point="TOPLEFT" x="16" y="-72" />
								</Anchors>
								<Scripts>
									<OnLoad>
										self:SetChecked(PowaAuras.Helpers:GetSetting("TimerRoundUp"));
										PowaAuras.UI:Checkbox(self, "TimerRoundUp");
									</OnLoad>
								</Scripts>
							</CheckButton>
							<CheckButton parentKey="BlockComms" text="UI_Config_BlockComms" inherits="PowaNormalCheckboxTemplate">
								<Size x="150" y="28" />
								<Anchors>
									<Anchor point="TOPLEFT" relativePoint="TOP" x="16" y="-72" />
								</Anchors>
								<Scripts>
									<OnLoad>
										self:SetChecked(PowaAuras.Helpers:GetSetting("BlockIncomingAuras"));
										PowaAuras.UI:Checkbox(self, "BlockIncomingAuras");
									</OnLoad>
								</Scripts>
							</CheckButton>
							<CheckButton parentKey="FixExports" text="UI_Config_FixExports" inherits="PowaNormalCheckboxTemplate">
								<Size x="150" y="28" />
								<Anchors>
									<Anchor point="TOPLEFT" x="16" y="-104" />
								</Anchors>
								<Scripts>
									<OnLoad>
										self:SetChecked(PowaAuras.Helpers:GetSetting("FixExports"));
										PowaAuras.UI:Checkbox(self, "FixExports");
									</OnLoad>
								</Scripts>
							</CheckButton>
							<Slider minValue="1" maxValue="100" defaultValue="100" valueStep="1" parentKey="UpdateSpeed" inherits="PowaSliderTemplate">
								<Size x="150" y="15" />
								<Anchors>
									<!-- Slider is designed in a weird way due to backdrop limitations, hence the huge Y offset -->
									<Anchor point="TOPLEFT" x="16" y="-190" />
								</Anchors>
								<Scripts>
									<OnLoad>
										PowaAuras.UI:Slider(self, "UI_Config_UpdateSpeed", "%");
									</OnLoad>
								</Scripts>
							</Slider>
							<Slider minValue="1" maxValue="100" defaultValue="100" valueStep="1" parentKey="TimerSpeed" inherits="PowaSliderTemplate">
								<Size x="150" y="15" />
								<Anchors>
									<!-- Slider is designed in a weird way due to backdrop limitations, hence the huge Y offset -->
									<Anchor point="TOPLEFT" relativePoint="TOP" x="16" y="-190" />
								</Anchors>
								<Scripts>
									<OnLoad>
										PowaAuras.UI:Slider(self, "UI_Config_TimerSpeed", "%");
									</OnLoad>
								</Scripts>
							</Slider>
							<EditBox parentKey="PathTex" inherits="PowaLabelledEditBoxTemplate">
								<Size x="150" y="24" />
								<Anchors>
									<Anchor point="TOPLEFT" x="16" y="-265" />
								</Anchors>
								<Scripts>
									<OnLoad>
										PowaAuras.UI:EditBox2(self, "", "UI_Config_PathTex");
									</OnLoad>
								</Scripts>
							</EditBox>
							<EditBox parentKey="PathSfx" inherits="PowaLabelledEditBoxTemplate">
								<Size x="150" y="24" />
								<Anchors>
									<Anchor point="TOPLEFT" relativePoint="TOP" x="16" y="-265" />
								</Anchors>
								<Scripts>
									<OnLoad>
										PowaAuras.UI:EditBox2(self, "", "UI_Config_PathSfx");
									</OnLoad>
								</Scripts>
							</EditBox>
						</Frames>
						<Scripts>
							<OnLoad>
								self.TitleConfig:SetText(PowaAuras.Text["UI_ConfigTitle"]);
								self.TitlePerformance:SetText(PowaAuras.Text["UI_ConfigTitlePerf"]);
								self.TitleCustom:SetText(PowaAuras.Text["UI_ConfigTitleCust"]);
							</OnLoad>
						</Scripts>
					</Frame>
					<Frame parentKey="Help" hidden="true">
						<Anchors>
							<Anchor point="TOPLEFT" x="4" y="-4" />
							<Anchor point="BOTTOMRIGHT" x="-4" y="5" />
						</Anchors>
						<Frames>
							<Frame name="$parentHelpTree" parentKey="Tree" inherits="PowaTreeViewTemplate">
								<Anchors>
									<Anchor point="TOPLEFT" x="2" y="-2" />
									<Anchor point="BOTTOMLEFT" x="2" y="2" />
								</Anchors>
								<Scripts>
									<OnLoad>
										PowaAuras.UI:TreeView(self);
									</OnLoad>
								</Scripts>
							</Frame>
						</Frames>
					</Frame>
				</Frames>
				<Scripts>
					<OnLoad>
						PowaAuras.UI:TabFrame(self, 4);
						self:RegisterTab(self.Auras, "Interface\\GossipFrame\\TrainerGossipIcon");
						self:RegisterTab(self.Config, "Interface\\GossipFrame\\BinderGossipIcon");
						self:RegisterTab(self.Help, { "Interface\\WorldMap\\UI-WorldMap-QuestIcon", 12, 17, 0.171875, 0.359375, 0.109375, 0.375 });
					</OnLoad>
				</Scripts>
			</Frame>
		</Frames>
	</Frame>
</Ui>
